name: Manual SSH Test

on:
  workflow_dispatch:  # Run manually from GitHub Actions UI

jobs:
  manual-ssh:
    runs-on: ubuntu-latest

    steps:
    - name: 🔐 Decode SSH Key
      run: |
        echo "${{ secrets.VM_SSH_KEY }}" | base64 --decode > id_rsa
        chmod 600 id_rsa

    - name: 🔌 Connect to Azure VM via manual SSH
      run: |
        ssh -i id_rsa -o StrictHostKeyChecking=no ${{ secrets.VM_USERNAME }}@${{ secrets.VM_HOST }} << 'EOF'
          echo "✅ Manual SSH worked!"
          whoami

    - name: 🧹 Clean up private key
      run: rm -f id_rsa
